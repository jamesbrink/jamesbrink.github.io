---
import Container from './Container.astro';
import clsx from 'clsx';

interface Props {
  class?: string;
}

const { class: className } = Astro.props;
const pathname = Astro.url.pathname;
const isHomePage = pathname === '/';

interface NavItem {
  href: string;
  label: string;
}

const navItems: NavItem[] = [
  { href: '/about', label: 'About' },
  { href: '/astrophotography', label: 'Photos' },
  { href: '/projects', label: 'Projects' },
  { href: '/blog', label: 'Articles' },
  { href: '/resume', label: 'Resume' },
];
---

<header class={clsx('pointer-events-none relative z-50 flex flex-none flex-col', className)}>
  {
    isHomePage && (
      <>
        <div class="order-last mt-[calc(theme(spacing.16)-theme(spacing.3))]" />
        <Container class="top-0 order-last -mb-3 pt-3">
          <div class="top-[var(--avatar-top,theme(spacing.3))] w-full">
            <div class="relative">
              <a href="/" aria-label="Home" class="pointer-events-auto block h-16 w-16 origin-left">
                <img
                  src="/images/avatar.jpg"
                  alt=""
                  class="h-16 w-16 rounded-full bg-zinc-100 object-cover dark:bg-zinc-800"
                />
              </a>
            </div>
          </div>
        </Container>
      </>
    )
  }
  <div class="top-0 z-10 h-16 pt-6">
    <Container>
      <div class="relative flex gap-4">
        <div class="flex flex-1">
          {
            !isHomePage && (
              <div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg ring-1 shadow-zinc-800/5 ring-zinc-900/5 backdrop-blur-sm dark:bg-zinc-800/90 dark:ring-white/10">
                <a href="/" aria-label="Home" class="pointer-events-auto">
                  <img
                    src="/images/avatar.jpg"
                    alt=""
                    class="h-9 w-9 rounded-full bg-zinc-100 object-cover dark:bg-zinc-800"
                  />
                </a>
              </div>
            )
          }
        </div>
        <div class="flex flex-1 justify-end md:justify-center">
          <!-- Mobile Navigation -->
          <div class="pointer-events-auto md:hidden">
            <button
              type="button"
              class="group flex items-center rounded-full bg-white/90 px-4 py-2 text-sm font-medium text-zinc-800 shadow-lg ring-1 shadow-zinc-800/5 ring-zinc-900/5 backdrop-blur-sm dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10 dark:hover:ring-white/20"
              aria-label="Toggle navigation"
              id="mobile-menu-button"
            >
              Menu
              <svg
                viewBox="0 0 8 6"
                aria-hidden="true"
                class="ml-3 h-auto w-2 stroke-zinc-500 group-hover:stroke-zinc-700 dark:group-hover:stroke-zinc-400"
              >
                <path
                  d="M1.75 1.75 4 4.25l2.25-2.5"
                  fill="none"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
              </svg>
            </button>
          </div>

          <!-- Desktop Navigation -->
          <nav class="pointer-events-auto hidden md:block">
            <ul
              class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg ring-1 shadow-zinc-800/5 ring-zinc-900/5 backdrop-blur-sm dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10"
            >
              {
                navItems.map((item) => {
                  const isActive = pathname === item.href || pathname.startsWith(item.href + '/');
                  return (
                    <li>
                      <a
                        href={item.href}
                        class={clsx(
                          'relative block px-3 py-2 transition',
                          isActive
                            ? 'text-teal-500 dark:text-teal-400'
                            : 'hover:text-teal-500 dark:hover:text-teal-400'
                        )}
                      >
                        {item.label}
                        {isActive && (
                          <span class="absolute inset-x-1 -bottom-px h-px bg-gradient-to-r from-teal-500/0 via-teal-500/40 to-teal-500/0 dark:from-teal-400/0 dark:via-teal-400/40 dark:to-teal-400/0" />
                        )}
                      </a>
                    </li>
                  );
                })
              }
            </ul>
          </nav>
        </div>
        <div class="flex justify-end md:flex-1">
          <div class="pointer-events-auto">
            <button
              type="button"
              aria-label="Toggle theme"
              class="group rounded-full bg-white/90 px-3 py-2 shadow-lg ring-1 shadow-zinc-800/5 ring-zinc-900/5 backdrop-blur-sm transition dark:bg-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20"
              id="theme-toggle"
            >
              <!-- Sun icon (light mode) -->
              <svg
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
                class="h-6 w-6 fill-zinc-100 stroke-zinc-500 transition group-hover:fill-zinc-200 group-hover:stroke-zinc-700 dark:hidden"
              >
                <path
                  d="M8 12.25A4.25 4.25 0 0 1 12.25 8v0a4.25 4.25 0 0 1 4.25 4.25v0a4.25 4.25 0 0 1-4.25 4.25v0A4.25 4.25 0 0 1 8 12.25v0Z"
                ></path>
                <path
                  d="M12.25 3v1.5M21.5 12.25H20M18.791 18.791l-1.06-1.06M18.791 5.709l-1.06 1.06M12.25 20v1.5M4.5 12.25H3M6.77 6.77 5.709 5.709M6.77 17.73l-1.061 1.061"
                  fill="none"></path>
              </svg>
              <!-- Moon icon (dark mode) -->
              <svg
                viewBox="0 0 24 24"
                aria-hidden="true"
                class="hidden h-6 w-6 fill-zinc-700 stroke-zinc-500 transition dark:block"
              >
                <path
                  d="M17.25 16.22a6.937 6.937 0 0 1-9.47-9.47 7.451 7.451 0 1 0 9.47 9.47ZM12.75 7C17 7 17 2.75 17 2.75S17 7 21.25 7C17 7 17 11.25 17 11.25S17 7 12.75 7Z"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </Container>
  </div>
</header>

{isHomePage && <div class="flex-none" style="height: var(--content-offset)" />}

<!-- Mobile Menu (hidden by default) -->
<div
  id="mobile-menu"
  class="fixed inset-x-4 top-8 z-50 hidden origin-top rounded-3xl bg-white p-8 ring-1 ring-zinc-900/5 dark:bg-zinc-900 dark:ring-zinc-800"
>
  <div class="flex flex-row-reverse items-center justify-between">
    <button type="button" aria-label="Close menu" class="-m-1 p-1" id="mobile-menu-close">
      <svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 text-zinc-500 dark:text-zinc-400">
        <path
          d="m17.25 6.75-10.5 10.5M6.75 6.75l10.5 10.5"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"></path>
      </svg>
    </button>
    <h2 class="text-sm font-medium text-zinc-600 dark:text-zinc-400">Navigation</h2>
  </div>
  <nav class="mt-6">
    <ul
      class="-my-2 divide-y divide-zinc-100 text-base text-zinc-800 dark:divide-zinc-100/5 dark:text-zinc-300"
    >
      {
        navItems.map((item) => (
          <li>
            <a href={item.href} class="block py-2">
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</div>

<!-- Mobile Menu Backdrop -->
<div
  id="mobile-menu-backdrop"
  class="fixed inset-0 z-40 hidden bg-zinc-800/40 backdrop-blur-sm dark:bg-black/80"
>
</div>

<script>
  // Theme toggle
  function initTheme() {
    const themeToggle = document.getElementById('theme-toggle');
    if (!themeToggle) return;

    themeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.contains('dark');
      document.documentElement.classList.toggle('dark', !isDark);
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    });
  }

  // Mobile menu
  function initMobileMenu() {
    const menuButton = document.getElementById('mobile-menu-button');
    const menuClose = document.getElementById('mobile-menu-close');
    const menu = document.getElementById('mobile-menu');
    const backdrop = document.getElementById('mobile-menu-backdrop');

    if (!menuButton || !menuClose || !menu || !backdrop) return;

    function openMenu() {
      menu!.classList.remove('hidden');
      backdrop!.classList.remove('hidden');
    }

    function closeMenu() {
      menu!.classList.add('hidden');
      backdrop!.classList.add('hidden');
    }

    menuButton.addEventListener('click', openMenu);
    menuClose.addEventListener('click', closeMenu);
    backdrop.addEventListener('click', closeMenu);
  }

  // Initialize on page load
  document.addEventListener('astro:page-load', () => {
    initTheme();
    initMobileMenu();
  });

  // Also run on initial load
  initTheme();
  initMobileMenu();
</script>
